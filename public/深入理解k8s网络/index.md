# 

# 深入理解k8s网络

TODO



 

> https://www.bilibili.com/video/BV1gD4y1B7Cq 李华明



**目录**

1. `k8s`网络概述
2. `CNI`插件
3. 集群内服务网络
4. 集群外访问
5. 网络安全策略



## 一、`k8s`网络概述

|      节点网络       |      容器网络       |      集群网络       |   网络安全   |
| :-----------------: | :-----------------: | :-----------------: | :----------: |
|   物理上是可达的    | Pod在相同Node上可达 |   提供服务的抽象    | 外部网络访问 |
| 承载跨节点网络流量  |  Pod跨node之间可达  | 服务到Pod的动态映射 |   安全策略   |
| 对CNI插件选型有影响 | CNI插件负责创建维护 |    提供负载均衡     |              |
|                     |                     |    提供服务发现     |              |



### 网络基础

#### TCP/IP网络模型



![image-20221101212527931](./深入理解k8s网络.assets/image-20221101212527931.png)

#### 以太网L2交换

#### IP L3转发

#### 网络命名空间&网桥



 

## 二、`CNI`插件



#### POD网络创建过程



![image-20221101215752417](./深入理解k8s网络.assets/image-20221101215752417.png)



#### CNI(container network interface)



![image-20221101220437409](./深入理解k8s网络.assets/image-20221101220437409.png)



#### vxlan 虚拟扩展局域网

![image-20221101220739044](./深入理解k8s网络.assets/image-20221101220739044.png)

#### flannel

- 每个节点分配一个子网，所有pod从本地子网中分配ip
- pod 在本节点通过 bridge L2通信
- 默认情况下，跨节点通过vxlan通信。通过flannel.1这个udp隧道进行流量转发
- 除了vxlan,flannel也支持IPIP,Host-GW两种后端。



![image-20221101221256469](./深入理解k8s网络.assets/image-20221101221256469.png)

#### BGP`(border gateway protocol)`

![image-20221101223717847](./深入理解k8s网络.assets/image-20221101223717847.png)



##  三、集群内服务网络

## 四、集群外访问

## 五、网络安全策略
